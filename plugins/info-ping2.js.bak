import fs from 'fs';
import os from 'os';
import { performance } from 'perf_hooks';

const tmas = number => {
  const map = {'0': 'ğŸ', '1': 'ğŸ', '2': 'ğŸ', '3': 'ğŸ‘', '4': 'ğŸ’', '5': 'ğŸ“', '6': 'ğŸ–', '7': 'ğŸ•', '8': 'ğŸ–', '9': 'ğŸ—'};
  return number.toString().split('').map(digit => map[digit] || digit).join('');
};

const clockString = ms => {
  const days = String(Math.floor(ms / 86400000)).padStart(2, '0');
  const hours = String(Math.floor((ms % 86400000) / 3600000)).padStart(2, '0');
  const minutes = String(Math.floor((ms % 3600000) / 60000)).padStart(2, '0');
  const seconds = String(Math.floor((ms % 60000) / 1000)).padStart(2, '0');

  return `${tmas(days)}:${tmas(hours)}:${tmas(minutes)}:${tmas(seconds)}`;
};

const handler = async (m, { conn }) => {
  const _uptime = process.uptime() * 1000;
  const uptime = clockString(_uptime);

  const speed = (performance.now() - performance.now()).toFixed(4);
  const speedWithFont = tmas(speed);

  const totalMemGB = (os.totalmem() / (1024 ** 3)).toFixed(2);
  const usedMemGB = ((os.totalmem() - os.freemem()) / (1024 ** 3)).toFixed(2);

  const { heapUsed, heapTotal } = process.memoryUsage();
  const heapUsedGB = (heapUsed / (1024 ** 2)).toFixed(2);
  const heapTotalGB = (heapTotal / (1024 ** 2)).toFixed(2);

  const mention = m.mentionedJid[0] || m.quoted?.sender || m.quoted || m.sender;
  const user = global.db.data.users[mention];
  const image = fs.readFileSync('./icone/ping.png');
  const nomeDelBot = global.db.data.nomedelbot || ' ê™° ğŸ¥ğŸ¥ğŸ¥ ğ”¹ğ•†ğ•‹  ê™°â‡';
  const kkk = {
    key: { participants: "0@s.whatsapp.net", fromMe: false, id: "ping333" },
    message: { documentMessage: { title: `${nomeDelBot} ğğ•€ğğ† ğŸ“`, jpegThumbnail: image } },
    participant: "0@s.whatsapp.net"
  };

  const info = `à³‹à³‹â•â• â€¢ â•â•à³‹à³‹\nğš²ğ“ğ“ğ•€ğ•ğ•€ğ“ğš²: ${uptime}\nğ•ğšµğ‹Íá«ğ‚ğ•€ğ“ğš²: ${speedWithFont} ğ’ğšµğ‚á«ğğƒğ•€\nğ‘ğ€ğŒ (server): ${usedMemGB} GB / ${totalMemGB} GB\nğŒğ„ğŒ (process): ${heapUsedGB} GB / ${heapTotalGB} GB\nà³‹à³‹â•â• â€¢ â•â•à³‹à³‹`.trim();

  conn.reply(m.chat, info, kkk, m);
};

handler.command = /^(ping333)$/i;
export default handler;
