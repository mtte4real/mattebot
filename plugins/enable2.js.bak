import fs from 'fs'; 
import fetch from 'node-fetch';

let handler = async (msg, { conn, usedPrefix, command, args }) => { 
    let chatConfig = global.db.data.chats[msg.chat] || {};

    const toggleOptions = {
        strillo: { configKey: "strillo", label: " *ð‘ºð’•ð’“ð’Šð’ð’ð’* " },
        antifroci: { configKey: "antifroci", label: " *ð‘¨ð’ð’•ð’Šð’‡ð’“ð’ð’„ð’Š* " },
        welcome: { configKey: "welcome", label: " *ð‘©ð’†ð’ð’—ð’†ð’ð’–ð’•ð’* " },
        sologruppo: { configKey: "sologruppo", label: " *ð‘ºð’ð’ð’ð’ˆð’“ð’–ð’‘ð’‘ð’* " },
        soloprivato: { configKey: "soloprivato", label: " *ð‘ºð’ð’ð’ð’‘ð’“ð’Šð’—ð’‚ð’•ð’* " },
        modoadmin: { configKey: "modoadmin", label: " *ð‘´ð’ð’…ð’ð’‚ð’…ð’Žð’Šð’* " },
        antipaki: { configKey: "antipaki", label: " *ð‘¨ð’ð’•ð’Šð’‘ð’‚ð’Œð’Š* " },
        antimedia: { configKey: "antimedia", label: " *ð‘¨ð’ð’•ð’Šð’Žð’†ð’…ð’Šð’‚* " },
        antilink: { configKey: "antilink", label: " *ð‘¨ð’ð’•ð’Šð’ð’Šð’ð’Œ* " },
        antilinktotale: { configKey: "antilinktotale", label: " *ð‘¨ð’ð’•ð’Šð’ð’Šð’ð’Œð’•ð’ð’•ð’‚ð’ð’†* " },
        antiinsta: { configKey: "antiinsta", label: " *ð‘¨ð’ð’•ð’Šð’Šð’ð’”ð’•ð’‚* " },
        antilinkch: { configKey: "antilinkch", label: " *ð‘¨ð’ð’•ð’Šð’ð’Šð’ð’Œð’„ð’‰* " },
        antitiktok: { configKey: "antitiktok", label: " *ð‘¨ð’ð’•ð’Šð’•ð’Šð’Œð’•ð’ð’Œ* " },
        antigiochi: { configKey: "antigiochi", label: " *ð‘¨ð’ð’•ð’Šð’ˆð’Šð’ð’„ð’‰ð’Š* " },
        antilinkgp: { configKey: "antilinkgp", label: " *ð‘¨ð’ð’•ð’Šð’ð’Šð’ð’Œð’ˆð’‘* " },
        antisbura: { configKey: "antisbura", label: " *ð‘¨ð’ð’•ð’Šð’”ð’ƒð’–ð’“ð’‚* " },
        stickers: { configKey: "stickers", label: " *ð‘ºð’•ð’Šð’„ð’Œð’†ð’“ð’”* " },
        antilinkhard: { configKey: "antilinkhard", label: " *ð‘¨ð’ð’•ð’Šð’ð’Šð’ð’Œð’‰ð’‚ð’“ð’…* " }
    };

    let enable = /true|enable|abilita|(turn)?on|1/i.test(command);
    let option = (args[0] || "").toLowerCase();

    if (!option) {
        let menuText = "â”ï¸ ð…ð®ð§ð³ð¢ð¨ð§ðž ð¢ð§ðžð¬ð¢ð¬ð­ðžð§ð­ðž \n> ð‘«ð’Šð’ˆð’Šð’•ð’‚ .ð’‡ð’–ð’ð’›ð’Šð’ð’ð’Š ð’‘ð’†ð’“ ð’”ð’‚ð’‘ð’†ð’“ð’† ð’ð’† ð’‡ð’–ð’ð’›ð’Šð’ð’ð’Š ð’‚ð’•ð’•ð’Šð’—ð’‚ð’ƒð’Šð’ð’Š ð’† ð’…ð’Šð’”ð’‚ð’•ð’•ð’Šð’—ð’‚ð’ƒð’Šð’ð’Š.";
        return conn.sendMessage(msg.chat, { text: menuText }, { quoted: msg });
    }

    if (!toggleOptions.hasOwnProperty(option)) {
        return conn.sendMessage(
            msg.chat,
            { text: "â”ï¸ ð…ð®ð§ð³ð¢ð¨ð§ðž ð¢ð§ðžð¬ð¢ð¬ð­ðžð§ð­ðž \n> ð‘«ð’Šð’ˆð’Šð’•ð’‚ .ð’‡ð’–ð’ð’›ð’Šð’ð’ð’Š ð’‘ð’†ð’“ ð’”ð’‚ð’‘ð’†ð’“ð’† ð’ð’† ð’‡ð’–ð’ð’›ð’Šð’ð’ð’Š ð’‚ð’•ð’•ð’Šð’—ð’‚ð’ƒð’Šð’ð’Š ð’† ð’…ð’Šð’”ð’‚ð’•ð’•ð’Šð’—ð’‚ð’ƒð’Šð’ð’Š." },
            { quoted: msg }
        );
    }

    let opt = toggleOptions[option];
    
    // Controlla se la funzione esiste in chatConfig, altrimenti la inizializza
    if (!(opt.configKey in chatConfig)) {
        chatConfig[opt.configKey] = false;
    }

    // Aggiorna lo stato della funzione
    chatConfig[opt.configKey] = enable;

    let stateText = enable ? " *ð‘¶ð‘µ* ðŸŸ©" : " *ð‘¶ð‘­ð‘­* ðŸŸ¥";
    return conn.sendMessage(
        msg.chat,
        { text: `> âœ¯ ${opt.label} âž¼ ${stateText}` },
        { quoted: msg }
    );
};

handler.help = ["toggle <opzione> [stato]"]; 
handler.tags = ["config"]; 
handler.admin = true
handler.command = /^((abilita|disattiva)|(turn)?[01])$/i;

export default handler;