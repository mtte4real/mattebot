import os from 'os';
import 'util';
import 'human-readable';
import '@whiskeysockets/baileys';
import 'fs';
import fetch from 'node-fetch'; 
import { performance } from 'perf_hooks';

let handler = async (m, { conn, usedPrefix }) => {
  try {
    const uptimeMs = process.uptime() * 1000;
    const uptimeStr = clockString(uptimeMs);
    const startTime = performance.now();
    const endTime = performance.now();
    const speed = (endTime - startTime).toFixed(4);

    const totalMem = os.totalmem();
    const freeMem = os.freemem();
    const usedMem = totalMem - freeMem;
    const percentUsed = ((usedMem / totalMem) * 100).toFixed(2);

    const totalMemGB = (totalMem / 1024 / 1024 / 1024).toFixed(2);
    const usedMemGB = (usedMem / 1024 / 1024 / 1024).toFixed(2);

    const botName = global.db?.data?.nomedelbot || "á´¼Ê³â±áµâ±â¿ á´®áµ’áµ—âœ¦";
    const imageResponse = await fetch('https://telegra.ph/file/2f38b3fd9cfba5935b496.jpg');
    if (!imageResponse.ok) throw new Error(`Errore durante la richiesta: ${imageResponse.status}`);

    const botStartTime = new Date(Date.now() - uptimeMs);
    const activationTime = botStartTime.toLocaleString('it-IT', {
      timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      day: '2-digit',
      month: '2-digit',
      year: 'numeric',
    });

    const message = `
ê§â”€â”€â”€â”€â”€â”€â€¢âœ¦â€¢â”€â”€â”€â”€â”€â”€ê§‚
                 ð“žð“»ð“²ð“°ð“²ð“· ð“‘ð“¸ð“½
ê§â”€â”€â”€â”€â”€â”€â€¢âœ¦â€¢â”€â”€â”€â”€â”€â”€ê§‚

ð‘¼ð’‘ð’•ð’Šð’Žð’†: ${uptimeStr}  
ð‘½ð’†ð’ð’ð’„ð’Šð’•ð’‚Ì€: ${speed} ms  
ð‘¹ð‘¨ð‘´ ð’–ð’”ð’‚ð’•ð’‚: ${usedMemGB} / ${totalMemGB} GB (${percentUsed}%)  
ð‘¨ð’—ð’—ð’Šð’: ${activationTime}

ê§â”€â”€â”€â”€â”€â”€â€¢âœ¦â€¢â”€â”€â”€â”€â”€â”€ê§‚
ð‘¶ð’˜ð’ð’†ð’“: Êá´á´œÉ´êœ±  
ð‘ºð’•ð’‚ð’•ð’: Online  
ð‘°ð‘®: instagram.com/il_mulatto07
ê§â”€â”€â”€â”€â”€â”€â€¢âœ¦â€¢â”€â”€â”€â”€â”€â”€ê§‚
`.trim();

    await conn.sendMessage(m.chat, {
      text: message,
      contextInfo: {
        mentionedJid: conn.parseMention(botName),
        // forwardingScore: 1,
       // isForwarded: true,
      },
    });
  } catch (err) {
    console.error("Errore nell'handler:", err);
  }
};

function clockString(ms) {
  let h = Math.floor(ms / 3600000);
  let m = Math.floor((ms % 3600000) / 60000);
  let s = Math.floor((ms % 60000) / 1000);
  return [h, m, s]
    .map(v => v.toString().padStart(2, '0'))
    .join(':');
}

handler.help = ['ping'];
handler.tags = ['info'];
handler.command = /^(ping|stato|info)$/i;

export default handler;
